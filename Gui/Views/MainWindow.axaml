<Window x:Class="Gui.Views.MainWindow" xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:amxc="using:Avalonia.Markup.Xaml.Converters" xmlns:cnv="using:Gui.Converters" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:generic="clr-namespace:System.Collections.Generic;assembly=System.Runtime" xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:mo="using:Gui.Models" xmlns:ol="using:ObjectEditor.Logging" xmlns:old5="using:Dat.Types.SCV5" xmlns:oldd="using:Dat.Data" xmlns:oldo="using:Dat.Objects" xmlns:oldt="using:Dat.Types" xmlns:pgc="clr-namespace:Avalonia.PropertyGrid.Controls;assembly=Avalonia.PropertyGrid" xmlns:rtb="clr-namespace:AvRichTextBox;assembly=AvRichTextBox" xmlns:sys="clr-namespace:System;assembly=mscorlib" xmlns:vi="using:Gui.Views" xmlns:vm="using:Gui.ViewModels" Title="{Binding WindowTitle}" Width="1920" Height="1080" d:DesignHeight="900" d:DesignWidth="1440" x:DataType="vm:MainWindowViewModel" Icon="/Assets/loco_icon.png" mc:Ignorable="d">
	<!--  https://docs.avaloniaui.net/docs/0.10.x/tutorials/music-store-app/creating-a-modern-looking-window  -->
	<Design.DataContext>
		<vm:MainWindowViewModel/>
	</Design.DataContext>
	<Window.Resources>
		<amxc:ColorToBrushConverter x:Key="ColorToBrushConverter"/>
		<cnv:EnumToMaterialIconConverter x:Key="EnumToMaterialIconConverter"/>
		<cnv:EnumDescriptionConverter x:Key="EnumDescriptionConverter"/>
		<cnv:EnumToBooleanConverter x:Key="EnumToBooleanConverter"/>
	</Window.Resources>
	<Window.DataTemplates>
		<!--  Mind the order of the Templates. Begin with the most specific first.  -->
		<DataTemplate DataType="old5:TileElement">
			<Grid DataContext="{Binding}" DockPanel.Dock="Left">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>
				<TextBlock Grid.Row="0" Grid.Column="0" Margin="4" VerticalAlignment="Center" Text="Type"/>
				<TextBox Grid.Row="0" Grid.Column="1" Margin="4" VerticalAlignment="Center" Text="{Binding Type}"/>
				<TextBlock Grid.Row="1" Grid.Column="0" Margin="4" VerticalAlignment="Center" Text="Flags"/>
				<TextBox Grid.Row="1" Grid.Column="1" Margin="4" VerticalAlignment="Center" IsReadOnly="True" Text="{Binding Flags}"/>
				<TextBlock Grid.Row="2" Grid.Column="0" Margin="4" VerticalAlignment="Center" Text="BaseZ"/>
				<TextBox Grid.Row="2" Grid.Column="1" Margin="4" VerticalAlignment="Center" IsReadOnly="True" Text="{Binding BaseZ}"/>
				<TextBlock Grid.Row="3" Grid.Column="0" Margin="4" VerticalAlignment="Center" Text="ClearZ"/>
				<TextBox Grid.Row="3" Grid.Column="1" Margin="4" VerticalAlignment="Center" IsReadOnly="True" Text="{Binding ClearZ}"/>
			</Grid>
		</DataTemplate>
		<DataTemplate DataType="vm:AudioViewModel">
			<Border BorderThickness="1">
				<StackPanel Background="{DynamicResource ScrollBarTrackFill}" Orientation="Vertical">
					<StackPanel Margin="4" Orientation="Horizontal">
						<TextBlock Margin="4" VerticalAlignment="Center" Text="{Binding SoundName}"/>
						<TextBlock Margin="4" VerticalAlignment="Center" Text="{Binding Duration}"/>
					</StackPanel>
					<OnPlatform>
						<OnPlatform.Windows>
							<StackPanel Margin="4" Orientation="Horizontal">
								<Button Margin="2" Padding="2" HorizontalAlignment="Stretch" Command="{Binding PlaySoundCommand}" ToolTip.Tip="Play audio">
									<DockPanel>
										<materialIcons:MaterialIcon Width="24" Height="24" Margin="2" Kind="Play"/>
										<TextBlock Margin="4" HorizontalAlignment="Stretch" VerticalAlignment="Center">
											Play
										</TextBlock>
									</DockPanel>
								</Button>
								<Button Margin="2" Padding="2" HorizontalAlignment="Stretch" Command="{Binding PauseSoundCommand}" ToolTip.Tip="Pause audio">
									<DockPanel>
										<materialIcons:MaterialIcon Width="24" Height="24" Margin="2" Kind="Pause"/>
										<TextBlock Margin="4" HorizontalAlignment="Stretch" VerticalAlignment="Center">
											Pause
										</TextBlock>
									</DockPanel>
								</Button>
								<Button Margin="2" Padding="2" HorizontalAlignment="Stretch" Command="{Binding StopSoundCommand}" ToolTip.Tip="Stop audio">
									<DockPanel>
										<materialIcons:MaterialIcon Width="24" Height="24" Margin="2" Kind="Stop"/>
										<TextBlock Margin="4" HorizontalAlignment="Stretch" VerticalAlignment="Center">
											Stop
										</TextBlock>
									</DockPanel>
								</Button>
								<Button Margin="2" Padding="2" HorizontalAlignment="Stretch" Command="{Binding ImportSoundCommand}" ToolTip.Tip="Import audio">
									<DockPanel>
										<materialIcons:MaterialIcon Width="24" Height="24" Margin="2" Kind="Import"/>
										<TextBlock Margin="4" HorizontalAlignment="Stretch" VerticalAlignment="Center">
											Import
										</TextBlock>
									</DockPanel>
								</Button>
								<Button Margin="2" Padding="2" HorizontalAlignment="Stretch" Command="{Binding ExportSoundCommand}" ToolTip.Tip="Export audio">
									<DockPanel>
										<materialIcons:MaterialIcon Width="24" Height="24" Margin="2" Kind="Export"/>
										<TextBlock Margin="4" HorizontalAlignment="Stretch" VerticalAlignment="Center">
											Export
										</TextBlock>
									</DockPanel>
								</Button>
							</StackPanel>
						</OnPlatform.Windows>
						<OnPlatform.Linux>
							<TextBlock Margin="4">Linux audio not currently supported :(</TextBlock>
						</OnPlatform.Linux>
						<OnPlatform.macOS>
							<TextBlock Margin="4">macOS audio not currently supported :(</TextBlock>
						</OnPlatform.macOS>
						<OnPlatform.Android>
							<TextBlock Margin="4">Android audio not currently supported :(</TextBlock>
						</OnPlatform.Android>
						<OnPlatform.iOS>
							<TextBlock Margin="4">iOS audio not currently supported :(</TextBlock>
						</OnPlatform.iOS>
					</OnPlatform>
				</StackPanel>
			</Border>
		</DataTemplate>
		<DataTemplate DataType="vm:MusicViewModel">
			<DockPanel>
				<ContentControl Content="{Binding AudioViewModel}" DockPanel.Dock="Left"/>
				<ScrollViewer>
					<pgc:PropertyGrid x:Name="propertyGrid_MusicInfo" DataContext="{Binding AudioViewModel.WaveStream.WaveFormat}"/>
				</ScrollViewer>
			</DockPanel>
		</DataTemplate>
		<DataTemplate DataType="vm:SoundEffectsViewModel">
			<ScrollViewer>
				<ItemsRepeater ItemsSource="{Binding AudioViewModels}">
					<ItemsRepeater.Layout>
						<UniformGridLayout Orientation="Horizontal"/>
					</ItemsRepeater.Layout>
					<ItemsRepeater.ItemTemplate>
						<DataTemplate>
							<ContentControl Margin="4" Content="{Binding}"/>
						</DataTemplate>
					</ItemsRepeater.ItemTemplate>
				</ItemsRepeater>
			</ScrollViewer>
		</DataTemplate>
		<DataTemplate DataType="vm:TutorialViewModel">
			<ScrollViewer>
				<ItemsRepeater Background="{DynamicResource ExpanderContentBackground}" ItemsSource="{Binding TutorialInputs}">
					<ItemsRepeater.ItemTemplate>
						<DataTemplate>
							<TextBlock Text="{Binding}"/>
						</DataTemplate>
					</ItemsRepeater.ItemTemplate>
				</ItemsRepeater>
			</ScrollViewer>
		</DataTemplate>
	</Window.DataTemplates>
	<DockPanel>
		<DockPanel DockPanel.Dock="Top">
			<Menu>
				<MenuItem Header="_File">
					<MenuItem Command="{Binding OpenSingleObject}" Header="Open single object (.DAT)" HotKey="Ctrl+O" InputGesture="Ctrl+O"/>
					<MenuItem Command="{Binding OpenG1}" Header="Open G1 (.DAT)" HotKey="Ctrl+G" InputGesture="Ctrl+G"/>
					<MenuItem Command="{Binding OpenSCV5}" Header="Open scenario/save game/landscape (.SC5/.SV5)" HotKey="Ctrl+H" InputGesture="Ctrl+H"/>
					<MenuItem Command="{Binding OpenMusic}" Header="Open music file (.DAT)" HotKey="Ctrl+M" InputGesture="Ctrl+M"/>
					<MenuItem Command="{Binding OpenSoundEffect}" Header="Open sound effect file (.DAT)" HotKey="Ctrl+F" InputGesture="Ctrl+F"/>
					<MenuItem Command="{Binding OpenTutorial}" Header="Open tutorial (.DAT)" HotKey="Ctrl+T" InputGesture="Ctrl+T"/>
					<MenuItem Command="{Binding OpenScores}" Header="Open scores file (.DAT) (coming soon)" HotKey="Ctrl+H" InputGesture="Ctrl+H" IsEnabled="False"/>
					<MenuItem Command="{Binding OpenLanguage}" Header="Open language file (.DAT) (coming soon)" HotKey="Ctrl+L" InputGesture="Ctrl+L" IsEnabled="False"/>
				</MenuItem>
				<MenuItem Classes="SubItems" Header="_Objects" ItemsSource="{Binding ObjDataItems}">
					<MenuItem.Styles>
						<Style x:DataType="vm:MenuItemViewModel" Selector="MenuItem.SubItems MenuItem">
							<Setter Property="Header" Value="{Binding Name}"/>
							<Setter Property="Command" Value="{Binding MenuCommand}"/>
						</Style>
					</MenuItem.Styles>
				</MenuItem>
				<MenuItem Header="_Palette">
					<MenuItem Command="{Binding UseDefaultPalette}" Header="Load default palette"/>
					<MenuItem Command="{Binding UseCustomPalette}" Header="Load custom palette"/>
				</MenuItem>
				<MenuItem Header="_Settings">
					<MenuItem Command="{Binding EditSettingsCommand}" Header="Edit settings"/>
					<MenuItem Command="{Binding OpenSettingsFolder}" Header="Open settings folder"/>
					<MenuItem Command="{Binding OpenDownloadFolder}" Header="Open downloads folder"/>
					<MenuItem Command="{Binding ShowLogsCommand}" Header="Show logs"/>
				</MenuItem>
			</Menu>
			<StackPanel HorizontalAlignment="Right" VerticalAlignment="Center" Orientation="Horizontal" Spacing="32">
				<Border BorderThickness="1" Margin="4" Background="{DynamicResource ButtonBackground}">
					<StackPanel Orientation="Horizontal" Spacing="4" IsVisible="{Binding IsUpdateAvailable}">
						<TextBlock Margin="4" HorizontalAlignment="Stretch" VerticalAlignment="Center">
							New version available!
						</TextBlock>
						<Button Command="{Binding OpenDownloadLink}" IsEnabled="{Binding IsUpdateAvailable}" IsVisible="{Binding IsUpdateAvailable}" Classes="information">
							<DockPanel>
								<TextBlock Margin="4" HorizontalAlignment="Stretch" VerticalAlignment="Center">
									View release notes
								</TextBlock>
								<materialIcons:MaterialIcon Width="24" Height="24" Margin="2" Kind="BookOpen"/>
							</DockPanel>
						</Button>
						<Button Command="{Binding DownloadLatestUpdate}" IsEnabled="{Binding IsUpdateAvailable}" IsVisible="{Binding IsUpdateAvailable}" Classes="update">
							<DockPanel>
								<TextBlock Margin="4" HorizontalAlignment="Stretch" VerticalAlignment="Center">
									Update and restart
								</TextBlock>
								<materialIcons:MaterialIcon Width="24" Height="24" Margin="2" Kind="Update"/>
							</DockPanel>
						</Button>
					</StackPanel>
				</Border>
				<ToggleSwitch Margin="4" IsChecked="{Binding IsDarkTheme, Mode=TwoWay}" OffContent="{materialIcons:MaterialIconExt Kind=WeatherSunny}" OnContent="{materialIcons:MaterialIconExt Kind=MoonWaningCrescent}"/>
			</StackPanel>
		</DockPanel>
		<Grid ColumnDefinitions="448, Auto, *" RowDefinitions="*">
			<ContentControl Grid.Column="0" Content="{Binding FolderTreeViewModel}"/>
			<GridSplitter Grid.Row="1" Grid.Column="1" Margin="4,0,4,0"/>
			<DockPanel Grid.Column="2" Margin="8" DataContext="{Binding CurrentTabModel}">
				<ToggleSwitch Margin="4" DockPanel.Dock="Top" IsChecked="{Binding OpenInNewTab, Mode=TwoWay}" IsVisible="{Binding OpenInNewTabIsVisible}" OffContent="{materialIcons:MaterialIconExt Kind=Tab}" OnContent="{materialIcons:MaterialIconExt Kind=TabAdd}"/>
				<TabControl Padding="0" ItemsSource="{Binding Documents}" SelectedItem="{Binding SelectedDocument}" WrapSelection="True">
					<TabControl.Styles>
						<Style Selector="TabItem">
							<Setter Property="Padding" Value="2, 0, 2, 0"/>
							<Setter Property="FontSize" Value="14"/>
						</Style>
					</TabControl.Styles>
					<TabControl.ItemTemplate>
						<DataTemplate>
							<TabItem MaxHeight="32" Margin="0" Padding="0" BorderThickness="0">
								<TabItem.Header>
									<StackPanel Background="{DynamicResource ButtonBackground}" Orientation="Horizontal">
										<TextBlock Margin="4" VerticalAlignment="Center" Text="{Binding CurrentFile.DisplayName}" TextAlignment="Left" ToolTip.Tip="{Binding CurrentFile.FileName}"/>
										<Button VerticalAlignment="Center" BorderThickness="0" Command="{Binding $parent[TabControl].((vm:TabViewPageViewModel)DataContext).RemoveTabCommand}" CommandParameter="{Binding}" FontSize="12" HotKey="Ctrl+F4" ToolTip.Tip="(Ctrl+F4)">
											X
										</Button>
									</StackPanel>
								</TabItem.Header>
								<TabItem.ContextMenu>
									<ContextMenu>
										<MenuItem Command="{Binding $parent[TabControl].((vm:TabViewPageViewModel)DataContext).CloseAllTabsCommand}" Header="Close All Tabs"/>
										<MenuItem Command="{Binding $parent[TabControl].((vm:TabViewPageViewModel)DataContext).CloseOtherTabsCommand}" CommandParameter="{Binding}" Header="Close Other Tabs"/>
									</ContextMenu>
								</TabItem.ContextMenu>
							</TabItem>
						</DataTemplate>
					</TabControl.ItemTemplate>
					<TabControl.ContentTemplate>
						<DataTemplate DataType="vm:ILocoFileViewModel">
							<Border BorderThickness="1">
								<DockPanel>
									<DockPanel DockPanel.Dock="Top">
										<Button Margin="4" Padding="2" Command="{Binding ReloadCommand}" DockPanel.Dock="Left" HotKey="F5" ToolTip.Tip="(F5)">
											<DockPanel>
												<materialIcons:MaterialIcon Width="24" Height="24" Margin="2" Kind="{Binding ReloadIcon}"/>
												<TextBlock Margin="4" HorizontalAlignment="Stretch" VerticalAlignment="Center" Text="{Binding ReloadText}"/>
											</DockPanel>
										</Button>
										<Button Margin="4" Padding="2" Command="{Binding SaveCommand}" DockPanel.Dock="Left" HotKey="Ctrl+S" ToolTip.Tip="(Ctrl+S)">
											<DockPanel>
												<materialIcons:MaterialIcon Width="24" Height="24" Margin="2" Kind="{Binding SaveIcon}"/>
												<TextBlock Margin="4" HorizontalAlignment="Stretch" VerticalAlignment="Center" Text="{Binding SaveText}"/>
											</DockPanel>
										</Button>
										<Button Margin="4" Padding="2" Command="{Binding SaveAsCommand}" DockPanel.Dock="Left" HotKey="Ctrl+Shift+S" ToolTip.Tip="(Ctrl+Shift+S)">
											<DockPanel>
												<materialIcons:MaterialIcon Width="24" Height="24" Margin="2" Kind="{Binding SaveAsIcon}"/>
												<TextBlock Margin="4" HorizontalAlignment="Stretch" VerticalAlignment="Center" Text="{Binding SaveAsText}"/>
											</DockPanel>
										</Button>
										<Button Margin="4" Padding="2" HorizontalAlignment="Right" Classes="danger" Command="{Binding DeleteLocalFileCommand}" DockPanel.Dock="Right" HotKey="Ctrl+D" IsEnabled="{Binding IsLocalMode}" IsVisible="{Binding IsLocalMode}" ToolTip.Tip="(Ctrl+D) WARNING: this will delete your local file without asking! Only click this if you're sure you want to delete this file!">
											<DockPanel>
												<materialIcons:MaterialIcon Width="24" Height="24" Margin="2" Kind="{Binding DeleteLocalFileIcon}"/>
												<TextBlock Margin="4" HorizontalAlignment="Stretch" VerticalAlignment="Center" Text="{Binding DeleteLocalFileText}"/>
											</DockPanel>
										</Button>
									</DockPanel>
									<ContentControl Content="{Binding}"/>
								</DockPanel>
							</Border>
						</DataTemplate>
					</TabControl.ContentTemplate>
				</TabControl>
			</DockPanel>
		</Grid>
	</DockPanel>
</Window>
